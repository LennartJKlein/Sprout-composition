// Сделано на основе пена http://codepen.io/SitePoint/pen/MwEaQM

(function($) {

	var _elements,
		_options;

	var methods = {
		init: function(elements, options) {

			_elements = elements;
			_options = options;

			methods.bind();
		},
		bind: function() {

			_options.window.scroll(function() {
				methods.animate(_elements, _options);
			});
			_options.window.trigger('scroll');
		},
		animate: function(elements, options) {

			var viewHeight = $(options.window).height(),
				viewTop =  $(options.window).scrollTop(),
				viewBottom = (viewTop + viewHeight);

			$.each(elements, function() {
				var elementAnimation = $(this).data('animate'),
					elementOffset = $(this).data('offset'),
					elementDuration = $(this).data('duration'),
					elementDelay = $(this).data('delay'),
					elementIteration = $(this).data('iteration'),
					elementHeight = $(this).outerHeight(),
					elementPosition = $(this).position(),
					elementTop = elementPosition.top,
					elementBottom = (elementTop + elementHeight);

				if (elementOffset) {
					elementTop = elementTop + elementOffset;
					elementBottom = elementBottom - elementOffset;
				}

				$(this).css({'-webkit-animation-duration': elementDuration, 'animation-duration': elementDuration});
				$(this).css({'-webkit-animation-delay': elementDelay, 'animation-delay': elementDelay});
				$(this).css({'-webkit-animation-iteration-count': elementIteration, 'animation-iteration-count': elementIteration});

				if ((elementBottom >= viewTop) && (elementTop <= viewBottom)) {
					$(this).css('visibility', 'visible');
					$(this).addClass(elementAnimation);
					$(this).addClass('animated');
				}
				else {
					if (options.once === false) {
						$(this).removeClass(elementAnimation);
						$(this).removeClass('animated');
					}

					if (!$(this).hasClass('animated')) {
						$(this).css('visibility', 'hidden');
					}
				}
			});
		}
	};

	jQuery.fn.scrolla = function(options) {
		options = $.extend({
			mobile: false,
			once: false,
			window: $(window),
		}, options);

		if (options.mobile === false) {
			if (navigator.userAgent.match(/Tablet|iPad/i)) {
				
			} else if (navigator.userAgent.match(/Mobile|Windows Phone|Lumia|Android|webOS|iPhone|iPod|Blackberry|PlayBook|BB10|Opera Mini|\bCrMo\/|Opera Mobi/i) ) {
				return false;
			}
		}

		methods.init(this, options);

	};
})(jQuery);